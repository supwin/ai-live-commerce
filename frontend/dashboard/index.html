<!--frontend/dashboard/index.html-->

<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Live Commerce - Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4A90E2;
            --secondary-color: #00ff88;
            --accent-color: #ff6b6b;
            --warning-color: #ffeb3b;
            --text-primary: #333333;
            --text-secondary: #666666;
            --background-light: #f8f9fa;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --error-color: #dc3545;
            --info-color: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-light);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid var(--border-color);
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .sidebar-header h1 {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .sidebar-header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 12px 20px;
            color: var(--text-primary);
            text-decoration: none;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-item:hover,
        .nav-item.active {
            background: var(--primary-color);
            color: white;
        }

        .nav-item i {
            margin-right: 10px;
            width: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }

        .page-header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .page-subtitle {
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary-color);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-card.success {
            border-left-color: var(--success-color);
        }

        .stat-card.warning {
            border-left-color: var(--warning-color);
        }

        .stat-card.info {
            border-left-color: var(--info-color);
        }

        .stat-card .stat-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .stat-card .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Content Sections */
        .content-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .section-actions {
            display: flex;
            gap: 10px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #357abd;
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: var(--text-primary);
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Product Cards */
        .products-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .product-card:hover {
            transform: translateY(-2px);
        }

        .product-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .product-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .product-sku {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .product-info {
            padding: 15px;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--success-color);
            margin-bottom: 10px;
        }

        .product-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .product-actions {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-processing {
            background: #fff3cd;
            color: #856404;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-actions {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Filters */
        .filters-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: #f8f9fa;
        }

        .filters-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }

        .filter-group label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Utilities */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .d-flex {
            display: flex;
        }

        .justify-between {
            justify-content: space-between;
        }

        .align-center {
            align-items: center;
        }

        .gap-10 {
            gap: 10px;
        }

        /* Alert Messages */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1><i class="fas fa-robot"></i> AI Live Commerce</h1>
                <p>Dashboard Control Panel</p>
            </div>
            <nav class="sidebar-nav">
                <a class="nav-item active" data-section="overview">
                    <i class="fas fa-chart-line"></i> Overview
                </a>
                <a class="nav-item" data-section="products">
                    <i class="fas fa-box"></i> Products
                </a>
                <a class="nav-item" data-section="scripts">
                    <i class="fas fa-script"></i> Scripts
                </a>
                <a class="nav-item" data-section="mp3">
                    <i class="fas fa-music"></i> MP3 Files
                </a>
                <a class="nav-item" data-section="videos">
                    <i class="fas fa-video"></i> Videos
                </a>
                <a class="nav-item" data-section="personas">
                    <i class="fas fa-users"></i> Personas
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1 class="page-title">AI Live Commerce Dashboard</h1>
                    <p class="page-subtitle">จัดการสินค้า สร้างสคริปต์ และเตรียมความพร้อมสำหรับ Live Streaming</p>
                </div>
                <button class="btn btn-primary" onclick="refreshDashboard()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>

            <!-- Alert Messages Container -->
            <div id="alert-container"></div>

            <!-- Overview Section -->
            <div class="content-section active" id="overview-section">
                <!-- Stats Cards -->
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-number" id="total-products">-</div>
                        <div class="stat-label">Total Products</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-number" id="active-products">-</div>
                        <div class="stat-label">Active Products</div>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-script"></i>
                        </div>
                        <div class="stat-number" id="total-scripts">-</div>
                        <div class="stat-label">Total Scripts</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <div class="stat-number" id="total-mp3s">-</div>
                        <div class="stat-label">MP3 Files</div>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div class="content-section" id="products-section">
                <div class="section-header">
                    <h2 class="section-title">Products Management</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="showCreateProductModal()">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                        <button class="btn btn-secondary" onclick="loadProducts()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-section">
                    <div class="filters-row">
                        <div class="filter-group">
                            <label>Category</label>
                            <select class="form-control" id="category-filter" onchange="loadProducts()">
                                <option value="">All Categories</option>
                                <option value="electronics">Electronics</option>
                                <option value="fashion">Fashion</option>
                                <option value="beauty">Beauty</option>
                                <option value="home">Home & Living</option>
                                <option value="sports">Sports</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Status</label>
                            <select class="form-control" id="status-filter" onchange="loadProducts()">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="out_of_stock">Out of Stock</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Search</label>
                            <input type="text" class="form-control" placeholder="Search products..."
                                id="search-products" onkeyup="searchProducts()">
                        </div>
                    </div>
                </div>

                <div class="products-grid" id="products-grid">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Loading products...</p>
                    </div>
                </div>
            </div>

            <!-- Scripts Section -->
            <div class="content-section" id="scripts-section">
                <div class="section-header">
                    <h2 class="section-title">Scripts Management</h2>
                    <div class="section-actions">
                        <select class="form-control" style="width: auto;" id="scripts-product-filter"
                            onchange="loadScripts()">
                            <option value="">Select Product</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadScripts()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                <div id="scripts-content">
                    <div class="loading">
                        <i class="fas fa-info-circle"></i>
                        <p>Select a product to view scripts...</p>
                    </div>
                </div>
            </div>

            <div class="content-section" id="mp3-section">
                <div class="section-header">
                    <h2 class="section-title">MP3 Files</h2>
                </div>
                <div class="loading">
                    <i class="fas fa-tools"></i>
                    <p>MP3 management coming soon...</p>
                </div>
            </div>

            <div class="content-section" id="videos-section">
                <div class="section-header">
                    <h2 class="section-title">Videos</h2>
                </div>
                <div class="loading">
                    <i class="fas fa-tools"></i>
                    <p>Video management coming soon...</p>
                </div>
            </div>

            <div class="content-section" id="personas-section">
                <div class="section-header">
                    <h2 class="section-title">Personas</h2>
                </div>
                <div class="loading">
                    <i class="fas fa-tools"></i>
                    <p>Persona management coming soon...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Container -->
    <div id="modal-container"></div>

    <script>
        // Global Variables
        let currentProducts = [];
        let filteredProducts = [];
        let currentScripts = [];
        let scriptPersonas = [];
        let voicePersonas = [];

        // Initialize Dashboard
        document.addEventListener('DOMContentLoaded', function () {
            initializeDashboard();
        });

        async function initializeDashboard() {
            console.log('🚀 Initializing AI Live Commerce Dashboard...');

            // Setup navigation
            setupNavigation();

            // Load initial data
            await Promise.all([
                loadDashboardStats(),
                loadProducts(),
                loadPersonas()
            ]);

            console.log('✅ Dashboard initialized successfully');
        }

        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            const contentSections = document.querySelectorAll('.content-section');

            navItems.forEach(item => {
                item.addEventListener('click', function (e) {
                    e.preventDefault();

                    const targetSection = this.getAttribute('data-section');

                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    // Update active content section
                    contentSections.forEach(section => section.classList.remove('active'));
                    document.getElementById(targetSection + '-section').classList.add('active');

                    // Load section-specific data
                    loadSectionData(targetSection);
                });
            });
        }

        async function loadSectionData(section) {
            switch (section) {
                case 'overview':
                    await loadDashboardStats();
                    break;
                case 'products':
                    await loadProducts();
                    break;
                case 'scripts':
                    await loadProductsForScriptsFilter();
                    break;
            }
        }

        // Load personas
        async function loadPersonas() {
            try {
                const [scriptResponse, voiceResponse] = await Promise.all([
                    fetch('/api/v1/dashboard/personas/script'),
                    fetch('/api/v1/dashboard/personas/voice')
                ]);

                if (scriptResponse.ok) {
                    scriptPersonas = await scriptResponse.json();
                }
                if (voiceResponse.ok) {
                    voicePersonas = await voiceResponse.json();
                }

            } catch (error) {
                console.error('Error loading personas:', error);
            }
        }

        // AI Script Generation
        function showAIScriptGenerationModal(productId) {
            const product = currentProducts.find(p => p.id === productId);

            if (!scriptPersonas.length) {
                showAlert('No script personas available. Please create script personas first.', 'error');
                return;
            }

            const modal = `
                <div class="modal-overlay" onclick="closeModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>🤖 Generate AI Scripts for ${escapeHtml(product.name)}</h3>
                            <button class="modal-close" onclick="closeModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">Script Persona:</label>
                                <select class="form-control" id="script-persona-select">
                                    ${scriptPersonas.map(persona =>
                `<option value="${persona.id}">${escapeHtml(persona.name)} - ${escapeHtml(persona.description || persona.speaking_style || '')}</option>`
            ).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Mood/Emotion:</label>
                                <select class="form-control" id="script-mood-select">
                                    <option value="auto">Auto (Let AI decide)</option>
                                    <option value="excited">😄 Excited - ตื่นเต้น กระตือรือร้น</option>
                                    <option value="professional">👔 Professional - มืออาชีพ เป็นทางการ</option>
                                    <option value="friendly">😊 Friendly - เป็นกันเอง อบอุ่น</option>
                                    <option value="confident">💪 Confident - มั่นใจ เชื่อมั่น</option>
                                    <option value="energetic">⚡ Energetic - มีพลัง เร่าร้อน</option>
                                    <option value="calm">😌 Calm - สงบ ใจเย็น</option>
                                    <option value="urgent">⏰ Urgent - เร่งด่วน จำกัดเวลา</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Number of Scripts:</label>
                                <select class="form-control" id="script-count-select">
                                    <option value="3">3 Scripts (Recommended)</option>
                                    <option value="5">5 Scripts</option>
                                    <option value="1">1 Script</option>
                                </select>
                            </div>
                            <div class="alert alert-info">
                                <strong>🎭 Emotional TTS:</strong> Scripts will include emotional markup tags for TTS to express the right mood and feeling.
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="executeAIScriptGeneration(${productId})">
                                <i class="fas fa-robot"></i> Generate Scripts
                            </button>
                        </div>
                    </div>
                </div>
            `;

            showModal(modal);
        }

        async function executeAIScriptGeneration(productId) {
            const personaId = document.getElementById('script-persona-select').value;
            const mood = document.getElementById('script-mood-select').value;
            const count = parseInt(document.getElementById('script-count-select').value);

            if (!personaId) {
                showAlert('Please select a script persona', 'error');
                return;
            }

            try {
                showAlert('Generating AI scripts with emotional markup...', 'info');
                closeModal();

                const response = await fetch('/api/v1/dashboard/scripts/generate-ai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        product_id: parseInt(productId),
                        persona_id: parseInt(personaId),
                        mood: mood,
                        count: count
                    })
                });

                if (response.ok) {
                    const scripts = await response.json();
                    showAlert(`Generated ${scripts.length} AI scripts with emotional markup successfully!`, 'success');

                    // Switch to scripts section and show the new scripts
                    switchToScriptsSection(productId);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to generate scripts');
                }

            } catch (error) {
                console.error('Error generating AI scripts:', error);
                showAlert('Failed to generate AI scripts: ' + error.message, 'error');
            }
        }

        function switchToScriptsSection(productId) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-section="scripts"]').classList.add('active');

            // Update content sections
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            document.getElementById('scripts-section').classList.add('active');

            // Set product filter and load scripts
            document.getElementById('scripts-product-filter').value = productId;
            loadScripts();
        }

        // Scripts Management
        async function loadProductsForScriptsFilter() {
            try {
                const response = await fetch('/api/v1/dashboard/products');
                const products = await response.json();

                const select = document.getElementById('scripts-product-filter');
                select.innerHTML = '<option value="">Select Product</option>' +
                    products.map(product => `<option value="${product.id}">${escapeHtml(product.name)} (${escapeHtml(product.sku)})</option>`).join('');

            } catch (error) {
                console.error('Error loading products for filter:', error);
            }
        }

        async function loadScripts() {
            const productId = document.getElementById('scripts-product-filter').value;
            const contentDiv = document.getElementById('scripts-content');

            if (!productId) {
                contentDiv.innerHTML = '<div class="loading"><i class="fas fa-info-circle"></i><p>Select a product to view scripts...</p></div>';
                return;
            }

            try {
                const response = await fetch(`/api/v1/dashboard/products/${productId}/scripts`);
                currentScripts = await response.json();

                displayScripts(productId);

            } catch (error) {
                console.error('Error loading scripts:', error);
                showAlert('Failed to load scripts', 'error');
            }
        }

        function displayScripts(productId) {
            const product = currentProducts.find(p => p.id == productId);
            const contentDiv = document.getElementById('scripts-content');

            contentDiv.innerHTML = `
                <div class="section-header" style="border-bottom: 1px solid var(--border-color);">
                    <h3>📝 Scripts for ${product ? escapeHtml(product.name) : 'Selected Product'}</h3>
                    <div class="section-actions">
                        <button class="btn btn-primary btn-sm" onclick="showCreateManualScriptModal(${productId})">
                            <i class="fas fa-plus"></i> Manual Script
                        </button>
                        <button class="btn btn-success btn-sm" onclick="showAIScriptGenerationModal(${productId})">
                            <i class="fas fa-robot"></i> AI Scripts
                        </button>
                    </div>
                </div>
                <div class="scripts-list" style="padding: 20px;">
                    ${currentScripts.length ? currentScripts.map(script => createScriptCard(script)).join('') :
                    '<div class="text-center" style="padding: 40px;"><i class="fas fa-script" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 15px;"></i><h3>No scripts found</h3><p>Generate some AI scripts to get started!</p><button class="btn btn-primary mt-10" onclick="showAIScriptGenerationModal(' + productId + ')"><i class="fas fa-robot"></i> Generate AI Scripts</button></div>'}
                </div>
            `;
        }

        function createScriptCard(script) {
            // Convert emotional markup to styled display
            const displayContent = formatEmotionalMarkup(script.content);

            return `
                <div class="script-card" style="background: white; border-radius: 8px; margin-bottom: 20px; padding: 20px; border-left: 4px solid var(--primary-color); box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div class="script-header" style="margin-bottom: 15px;">
                        <h4 style="margin-bottom: 5px;">${escapeHtml(script.title)}</h4>
                        <div class="d-flex gap-10 align-center" style="flex-wrap: wrap;">
                            <span class="status-badge ${script.has_mp3 ? 'status-completed' : 'status-processing'}">
                                ${script.has_mp3 ? '🎵 Has MP3' : '📝 Script Only'}
                            </span>
                            <span class="status-badge status-info">${script.script_type}</span>
                            ${script.persona_name ? `<span class="status-badge status-active">👤 ${escapeHtml(script.persona_name)}</span>` : ''}
                            ${script.target_emotion ? `<span class="status-badge" style="background: #e3f2fd; color: #1976d2;">🎭 ${script.target_emotion}</span>` : ''}
                            ${script.duration_estimate ? `<span class="text-secondary">⏱️ ~${script.duration_estimate}s</span>` : ''}
                        </div>
                    </div>
                    <div class="script-content" style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 15px; max-height: 300px; overflow-y: auto; line-height: 1.6;">
                        ${displayContent}
                    </div>
                    <div class="script-actions">
                        <button class="btn btn-info btn-sm" onclick="viewScriptDetails(${script.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                        ${!script.has_mp3 ? `
                            <button class="btn btn-success btn-sm" onclick="generateMP3ForScript(${script.id})">
                                <i class="fas fa-music"></i> Create MP3
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="editScript(${script.id})" ${!script.can_edit ? 'disabled' : ''}>
                                <i class="fas fa-edit"></i> ${script.can_edit ? 'Edit' : 'Locked'}
                            </button>
                        ` : `
                            <button class="btn btn-warning btn-sm" onclick="playMP3(${script.id})">
                                <i class="fas fa-play"></i> Play MP3
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMP3(${script.id})">
                                <i class="fas fa-trash"></i> Delete MP3
                            </button>
                        `}
                        <button class="btn btn-danger btn-sm" onclick="deleteScript(${script.id}, '${escapeHtml(script.title)}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `;
        }

        function formatEmotionalMarkup(content) {
            // Convert emotional markup to styled HTML
            let formatted = escapeHtml(content);

            // Define emotion colors and styles
            const emotionStyles = {
                'excited': 'color: #ff6b35; font-weight: bold;',
                'happy': 'color: #4ecdc4; font-weight: bold;',
                'professional': 'color: #2c5aa0; font-weight: 500;',
                'confident': 'color: #8e44ad; font-weight: bold;',
                'energetic': 'color: #e74c3c; font-weight: bold;',
                'calm': 'color: #27ae60; font-style: italic;',
                'warm': 'color: #f39c12; font-weight: 500;',
                'friendly': 'color: #16a085; font-weight: 500;',
                'trustworthy': 'color: #34495e; font-weight: 500;',
                'urgent': 'color: #e74c3c; font-weight: bold; text-decoration: underline;'
            };

            // Replace emotional markup with styled spans
            Object.keys(emotionStyles).forEach(emotion => {
                const openTag = `{${emotion}}`;
                const closeTag = `{/${emotion}}`;
                const style = emotionStyles[emotion];

                const regex = new RegExp(`\\{${emotion}\\}(.*?)\\{\\/${emotion}\\}`, 'g');
                formatted = formatted.replace(regex, `<span style="${style}" title="Emotion: ${emotion}">$1</span>`);
            });

            // Convert line breaks
            formatted = formatted.replace(/\\n/g, '<br>');

            return formatted;
        }

        // Add product card action for AI script generation
        function addAIScriptButton(productId) {
            return `<button class="btn btn-success btn-sm" onclick="showAIScriptGenerationModal(${productId})">
                        <i class="fas fa-robot"></i> AI Scripts
                    </button>`;
        }

        // Placeholder functions for script actions
        function viewScriptDetails(scriptId) {
            showAlert('Script details view coming soon!', 'info');
        }

        function editScript(scriptId) {
            showAlert('Script editing coming soon!', 'info');
        }

        function deleteScript(scriptId, title) {
            if (confirm(`Are you sure you want to delete "${title}"?\n\nThis will also delete any related MP3 files.`)) {
                showAlert('Script deletion coming soon!', 'info');
            }
        }

        function generateMP3ForScript(scriptId) {
            showAlert('MP3 generation coming soon!', 'info');
        }

        function playMP3(scriptId) {
            showAlert('MP3 player coming soon!', 'info');
        }

        function deleteMP3(scriptId) {
            showAlert('MP3 deletion coming soon!', 'info');
        }

        function showCreateManualScriptModal(productId) {
            showAlert('Manual script creation coming soon!', 'info');
        }

        // Dashboard Stats
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/v1/dashboard/stats');
                const data = await response.json();

                document.getElementById('total-products').textContent = data.products.total;
                document.getElementById('active-products').textContent = data.products.active;
                document.getElementById('total-scripts').textContent = data.content.scripts;
                document.getElementById('total-mp3s').textContent = data.content.mp3_files;

            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                showAlert('Failed to load dashboard statistics', 'error');
            }
        }

        // Products Management
        async function loadProducts() {
            const categoryFilter = document.getElementById('category-filter')?.value || '';
            const statusFilter = document.getElementById('status-filter')?.value || '';

            try {
                showProductsLoading();

                const params = new URLSearchParams();
                if (categoryFilter) params.append('category', categoryFilter);
                if (statusFilter) params.append('status', statusFilter);

                const response = await fetch(`/api/v1/dashboard/products?${params}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                currentProducts = data.products || [];
                filteredProducts = [...currentProducts];

                displayProducts();

            } catch (error) {
                console.error('Error loading products:', error);
                showAlert('Failed to load products: ' + error.message, 'error');
                showProductsError();
            }
        }

        function showProductsLoading() {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = `
                <div class="loading" style="grid-column: 1/-1;">
                    <i class="fas fa-spinner"></i>
                    <p>Loading products...</p>
                </div>
            `;
        }

        function showProductsError() {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = `
                <div class="text-center" style="grid-column: 1/-1; padding: 40px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--error-color); margin-bottom: 15px;"></i>
                    <h3>Failed to load products</h3>
                    <p>Please check your connection and try again.</p>
                    <button class="btn btn-primary mt-10" onclick="loadProducts()">
                        <i class="fas fa-retry"></i> Retry
                    </button>
                </div>
            `;
        }

        function displayProducts() {
            const grid = document.getElementById('products-grid');

            if (!filteredProducts.length) {
                grid.innerHTML = `
                    <div class="text-center" style="grid-column: 1/-1; padding: 40px;">
                        <i class="fas fa-box" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 15px;"></i>
                        <h3>No products found</h3>
                        <p>Start by adding your first product!</p>
                        <button class="btn btn-primary mt-10" onclick="showCreateProductModal()">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredProducts.map(product => createProductCard(product)).join('');
        }

        function createProductCard(product) {
            return `
                <div class="product-card">
                    <div class="product-header">
                        <div class="product-name">${escapeHtml(product.name)}</div>
                        <div class="product-sku">SKU: ${escapeHtml(product.sku)}</div>
                    </div>
                    <div class="product-info">
                        <div class="product-price">
                            ${product.is_on_sale ?
                    `<span style="text-decoration: line-through; color: #999; font-size: 0.9rem;">฿${(product.original_price || 0).toLocaleString()}</span>
                                ฿${(product.sale_price || 0).toLocaleString()} <span style="color: var(--error-color); font-size: 0.8rem;">(-${product.discount_percentage || 0}%)</span>` :
                    `฿${(product.price || 0).toLocaleString()}`
                }
                        </div>
                        <div class="product-stats">
                            <span><i class="fas fa-script"></i> ${product.total_scripts || 0} scripts</span>
                            <span><i class="fas fa-music"></i> ${product.total_mp3s || 0} MP3s</span>
                            <span><i class="fas fa-video"></i> ${product.total_videos || 0} videos</span>
                        </div>
                        <div>
                            <span class="status-badge ${product.status === 'active' ? 'status-active' : 'status-error'}">${product.status || 'unknown'}</span>
                            ${product.has_content_ready ? '<span class="status-badge status-completed">Live Ready</span>' : ''}
                        </div>
                        ${product.description ? `<p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">${escapeHtml(product.description.substring(0, 100))}${product.description.length > 100 ? '...' : ''}</p>` : ''}
                    </div>
                    <div class="product-actions">
                        <button class="btn btn-primary btn-sm" onclick="viewProduct(${product.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-success btn-sm" onclick="showAIScriptGenerationModal(${product.id})">
                            <i class="fas fa-robot"></i> AI Scripts
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="editProduct(${product.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id}, '${escapeHtml(product.name)}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `;
        }

        function searchProducts() {
            const searchTerm = document.getElementById('search-products').value.toLowerCase();

            if (!searchTerm) {
                filteredProducts = [...currentProducts];
            } else {
                filteredProducts = currentProducts.filter(product =>
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.sku.toLowerCase().includes(searchTerm) ||
                    (product.description && product.description.toLowerCase().includes(searchTerm)) ||
                    (product.category && product.category.toLowerCase().includes(searchTerm)) ||
                    (product.brand && product.brand.toLowerCase().includes(searchTerm))
                );
            }

            displayProducts();
        }

        // Product CRUD Operations
        function showCreateProductModal() {
            const modal = `
                <div class="modal-overlay" onclick="closeModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3><i class="fas fa-plus"></i> Add New Product</h3>
                            <button class="modal-close" onclick="closeModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="product-form">
                                <div class="form-group">
                                    <label class="form-label">SKU *</label>
                                    <input type="text" class="form-control" id="product-sku" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" id="product-name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Description</label>
                                    <textarea class="form-control" id="product-description" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Price *</label>
                                    <input type="number" class="form-control" id="product-price" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Original Price</label>
                                    <input type="number" class="form-control" id="product-original-price" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Discount %</label>
                                    <input type="number" class="form-control" id="product-discount" min="0" max="100">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select class="form-control" id="product-category">
                                        <option value="">Select Category</option>
                                        <option value="electronics">Electronics</option>
                                        <option value="fashion">Fashion</option>
                                        <option value="beauty">Beauty</option>
                                        <option value="home">Home & Living</option>
                                        <option value="sports">Sports</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Brand</label>
                                    <input type="text" class="form-control" id="product-brand">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Stock Quantity</label>
                                    <input type="number" class="form-control" id="product-stock" min="0">
                                </div>
                            </form>
                        </div>
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveProduct()">
                                <i class="fas fa-save"></i> Save Product
                            </button>
                        </div>
                    </div>
                </div>
            `;

            showModal(modal);
        }

        async function saveProduct() {
            const productData = {
                sku: document.getElementById('product-sku').value,
                name: document.getElementById('product-name').value,
                description: document.getElementById('product-description').value,
                price: parseFloat(document.getElementById('product-price').value),
                original_price: parseFloat(document.getElementById('product-original-price').value) || null,
                discount_percentage: parseInt(document.getElementById('product-discount').value) || 0,
                category: document.getElementById('product-category').value,
                brand: document.getElementById('product-brand').value,
                stock_quantity: parseInt(document.getElementById('product-stock').value) || 0
            };

            // Basic validation
            if (!productData.sku || !productData.name || !productData.price) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }

            try {
                const response = await fetch('/api/v1/dashboard/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to create product');
                }

                const newProduct = await response.json();

                closeModal();
                showAlert('Product created successfully!', 'success');
                await loadProducts();

            } catch (error) {
                console.error('Error creating product:', error);
                showAlert('Failed to create product: ' + error.message, 'error');
            }
        }

        async function viewProduct(id) {
            try {
                const response = await fetch(`/api/v1/dashboard/products/${id}`);

                if (!response.ok) {
                    throw new Error('Product not found');
                }

                const product = await response.json();

                const modal = `
                    <div class="modal-overlay" onclick="closeModal()">
                        <div class="modal-content" onclick="event.stopPropagation()">
                            <div class="modal-header">
                                <h3><i class="fas fa-eye"></i> Product Details</h3>
                                <button class="modal-close" onclick="closeModal()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                    <div>
                                        <strong>SKU:</strong> ${escapeHtml(product.sku)}<br>
                                        <strong>Name:</strong> ${escapeHtml(product.name)}<br>
                                        <strong>Category:</strong> ${escapeHtml(product.category || 'N/A')}<br>
                                        <strong>Brand:</strong> ${escapeHtml(product.brand || 'N/A')}<br>
                                        <strong>Status:</strong> <span class="status-badge ${product.status === 'active' ? 'status-active' : 'status-error'}">${product.status}</span>
                                    </div>
                                    <div>
                                        <strong>Price:</strong> ฿${(product.price || 0).toLocaleString()}<br>
                                        ${product.original_price ? `<strong>Original Price:</strong> ฿${product.original_price.toLocaleString()}<br>` : ''}
                                        ${product.discount_percentage ? `<strong>Discount:</strong> ${product.discount_percentage}%<br>` : ''}
                                        <strong>Stock:</strong> ${product.stock_quantity || 0} units<br>
                                    </div>
                                </div>
                                ${product.description ? `<div style="margin-top: 20px;"><strong>Description:</strong><br>${escapeHtml(product.description)}</div>` : ''}
                                <div style="margin-top: 20px;">
                                    <strong>Content Status:</strong><br>
                                    <span><i class="fas fa-script"></i> Scripts: ${product.total_scripts || 0}</span> | 
                                    <span><i class="fas fa-music"></i> MP3s: ${product.total_mp3s || 0}</span> | 
                                    <span><i class="fas fa-video"></i> Videos: ${product.total_videos || 0}</span>
                                </div>
                            </div>
                            <div class="modal-actions">
                                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                                <button class="btn btn-primary" onclick="closeModal(); editProduct(${product.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                showModal(modal);

            } catch (error) {
                console.error('Error loading product:', error);
                showAlert('Failed to load product details', 'error');
            }
        }

        function editProduct(id) {
            // Load product data for editing
            loadProductForEdit(id);
        }

        async function loadProductForEdit(id) {
            try {
                const response = await fetch(`/api/v1/dashboard/products/${id}`);

                if (!response.ok) {
                    throw new Error('Product not found');
                }

                const product = await response.json();
                showEditProductModal(product);

            } catch (error) {
                console.error('Error loading product for edit:', error);
                showAlert('Failed to load product for editing', 'error');
            }
        }

        function showEditProductModal(product) {
            const modal = `
                <div class="modal-overlay" onclick="closeModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3><i class="fas fa-edit"></i> Edit Product: ${escapeHtml(product.name)}</h3>
                            <button class="modal-close" onclick="closeModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="edit-product-form">
                                <input type="hidden" id="edit-product-id" value="${product.id}">
                                <div class="form-group">
                                    <label class="form-label">SKU *</label>
                                    <input type="text" class="form-control" id="edit-product-sku" value="${escapeHtml(product.sku)}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" id="edit-product-name" value="${escapeHtml(product.name)}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Description</label>
                                    <textarea class="form-control" id="edit-product-description" rows="3">${escapeHtml(product.description || '')}</textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Price *</label>
                                    <input type="number" class="form-control" id="edit-product-price" step="0.01" value="${product.price || ''}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Original Price</label>
                                    <input type="number" class="form-control" id="edit-product-original-price" step="0.01" value="${product.original_price || ''}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Discount %</label>
                                    <input type="number" class="form-control" id="edit-product-discount" min="0" max="100" value="${product.discount_percentage || 0}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select class="form-control" id="edit-product-category">
                                        <option value="">Select Category</option>
                                        <option value="electronics" ${product.category === 'electronics' ? 'selected' : ''}>Electronics</option>
                                        <option value="fashion" ${product.category === 'fashion' ? 'selected' : ''}>Fashion</option>
                                        <option value="beauty" ${product.category === 'beauty' ? 'selected' : ''}>Beauty</option>
                                        <option value="home" ${product.category === 'home' ? 'selected' : ''}>Home & Living</option>
                                        <option value="sports" ${product.category === 'sports' ? 'selected' : ''}>Sports</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Brand</label>
                                    <input type="text" class="form-control" id="edit-product-brand" value="${escapeHtml(product.brand || '')}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Stock Quantity</label>
                                    <input type="number" class="form-control" id="edit-product-stock" min="0" value="${product.stock_quantity || 0}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Key Features (one per line)</label>
                                    <textarea class="form-control" id="edit-product-features" rows="3" placeholder="Enter key features, one per line">${(product.key_features || []).join('\\n')}</textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Selling Points (one per line)</label>
                                    <textarea class="form-control" id="edit-product-selling-points" rows="3" placeholder="Enter selling points, one per line">${(product.selling_points || []).join('\\n')}</textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Target Audience</label>
                                    <input type="text" class="form-control" id="edit-product-target-audience" value="${escapeHtml(product.target_audience || '')}" placeholder="e.g., Young professionals, Tech enthusiasts">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Promotion Text</label>
                                    <input type="text" class="form-control" id="edit-product-promotion" value="${escapeHtml(product.promotion_text || '')}" placeholder="Special promotion text">
                                </div>
                            </form>
                        </div>
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="updateProduct()">
                                <i class="fas fa-save"></i> Update Product
                            </button>
                        </div>
                    </div>
                </div>
            `;

            showModal(modal);
        }

        async function updateProduct() {
            const productId = document.getElementById('edit-product-id').value;
            const productData = {
                sku: document.getElementById('edit-product-sku').value,
                name: document.getElementById('edit-product-name').value,
                description: document.getElementById('edit-product-description').value,
                price: parseFloat(document.getElementById('edit-product-price').value),
                original_price: parseFloat(document.getElementById('edit-product-original-price').value) || null,
                discount_percentage: parseInt(document.getElementById('edit-product-discount').value) || 0,
                category: document.getElementById('edit-product-category').value,
                brand: document.getElementById('edit-product-brand').value,
                stock_quantity: parseInt(document.getElementById('edit-product-stock').value) || 0,
                key_features: document.getElementById('edit-product-features').value.split('\\n').filter(f => f.trim()),
                selling_points: document.getElementById('edit-product-selling-points').value.split('\\n').filter(f => f.trim()),
                target_audience: document.getElementById('edit-product-target-audience').value,
                promotion_text: document.getElementById('edit-product-promotion').value
            };

            // Basic validation
            if (!productData.sku || !productData.name || !productData.price) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }

            try {
                const response = await fetch(`/api/v1/dashboard/products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to update product');
                }

                const updatedProduct = await response.json();

                closeModal();
                showAlert('Product updated successfully!', 'success');
                await loadProducts();

            } catch (error) {
                console.error('Error updating product:', error);
                showAlert('Failed to update product: ' + error.message, 'error');
            }
        }

        async function deleteProduct(id, name) {
            if (!confirm(`Are you sure you want to delete "${name}"?\n\nThis will also delete all related scripts, MP3s, and videos.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/v1/dashboard/products/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('Failed to delete product');
                }

                showAlert('Product deleted successfully!', 'success');
                await loadProducts();
                await loadDashboardStats();

            } catch (error) {
                console.error('Error deleting product:', error);
                showAlert('Failed to delete product: ' + error.message, 'error');
            }
        }

        // Utility Functions
        function showModal(content) {
            document.getElementById('modal-container').innerHTML = content;
        }

        function closeModal() {
            document.getElementById('modal-container').innerHTML = '';
        }

        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alert-container');
            const alertClass = type === 'error' ? 'alert-error' : type === 'success' ? 'alert-success' : 'alert-info';

            const alert = document.createElement('div');
            alert.className = `alert ${alertClass}`;
            alert.innerHTML = `
                ${message}
                <button style="float: right; background: none; border: none; font-size: 1.2rem; cursor: pointer;" onclick="this.parentElement.remove()">&times;</button>
            `;

            alertContainer.appendChild(alert);

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alert.parentElement) {
                    alert.remove();
                }
            }, 5000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Backwards compatibility function
        async function generateAIScripts(productId) {
            showAIScriptGenerationModal(productId);
        }

        async function refreshDashboard() {
            await initializeDashboard();
            showAlert('Dashboard refreshed successfully!', 'success');
        }
    </script>
</body>

</html>